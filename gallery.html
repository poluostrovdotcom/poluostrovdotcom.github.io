<!DOCTYPE html>
<html class="wide wow-animation" lang="en">
  <head>
    <!-- Site Title-->
    <title>Фото и Видео | Полуостров Им. Леонида Духовного</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" property="og:description" content="Aрхив фото и видео Леонида Духовного" />
    <meta name="author" content="КСП Полуостров" />
    <meta name="image" property="og:image" content="http://poluostrov.com/images/gallery-preview.jpg">
    <meta name="robots" content="all">
    <meta name="googlebot" content="all">
    <meta property="og:url"                content="https://poluostrov.com/gallery.html" />
    <meta property="og:type"               content="gallery" />
    <meta property="og:title"              content="Фото и Видео | Полуостров Им. Леонида Духовного" />
    <meta charset="utf-8">
    <link rel="icon" href="/images//favicon.ico" type="image/x-icon">
    <!-- Stylesheets-->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/style.css">
    <style>.ie-panel{display: none;background: #212121;padding: 10px 0;box-shadow: 3px 3px 5px 0 rgba(0,0,0,.3);clear: both;text-align:center;position: relative;z-index: 1;} html.ie-10 .ie-panel, html.lt-ie-10 .ie-panel {display: block;}</style>
  </head>
  <script>
  
  const drive_preload = {
    api_key: "AIzaSyCqC17-M7h5Bgr8BuEznkCrZ9RFFLyNWUI",
    children_loaded: false,
    self_loaded: false,
    follow: function () {},
    id: "",
    parent: null,
    self: {},
    children: {},
    fetchList: function() {
      fetch("https://www.googleapis.com/drive/v3/files?key="+this.api_key+"&q=%27"+this.id+"%27%20in%20parents")
      .then(response => response.json())
      .then( data => this.setList(data))
      .catch(function (err) { console.log(err);} );
    },
    setList: function(data) {
      this.children = data.files;
      this.children_loaded = true;
      this.follow(this);
      //this.maybeExecute();
    },
    fetchInfo: function() {
      fetch("https://www.googleapis.com/drive/v3/files/"+this.id+"/?key="+this.api_key)
      .then(response => response.json())
      .then( data => this.setInfo(data))
      .catch(function (err) { console.log(err);} );
    },
    setInfo(data) {
      this.self = data;
      this.self_loaded = true;
    },
    init(id,parent=null,follow=null) {
      this.self_loaded = false;
      this.children_loaded = false;
      this.id = id;
      if (parent) {
        this.parent = parent;
        this.self_loaded = true;
        this.follow = follow;
        for (var i=0; i<parent.children.length; i++) 
          if (parent.children[i]["id"]==id)
          {
            this.self = parent.children[i];
            break;
          }
      }
      else {
        this.parent = null;
        this.fetchInfo();
      }
      this.fetchList();
    }
}

drive_preload.init("1jEQDNpok5Xfj2xLEq0XjXlEXT3ATw9K7");


  </script>
  <body>
    <!-- Page Loader-->
    <div id="page-loader">
      <div class="page-loader-body">
        <div class="cssload-spinner" style="display: none;">
          <div class="cssload-cube cssload-cube0"></div>
          <div class="cssload-cube cssload-cube1"></div>
          <div class="cssload-cube cssload-cube2"></div>
          <div class="cssload-cube cssload-cube3"></div>
          <div class="cssload-cube cssload-cube4"></div>
          <div class="cssload-cube cssload-cube5"></div>
          <div class="cssload-cube cssload-cube6"> </div>
          <div class="cssload-cube cssload-cube7"></div>
          <div class="cssload-cube cssload-cube8"></div>
          <div class="cssload-cube cssload-cube9"></div>
          <div class="cssload-cube cssload-cube10"></div>
          <div class="cssload-cube cssload-cube11"></div>
          <div class="cssload-cube cssload-cube12"></div>
          <div class="cssload-cube cssload-cube13"></div>
          <div class="cssload-cube cssload-cube14"></div>
          <div class="cssload-cube cssload-cube15"></div>
        </div>
      </div>
    </div>
    <!-- Page-->
    <div class="page">
      <!-- Page header-->
      <header class="section page-header">
        <!-- RD Navbar-->
        <div class="rd-navbar-wrap">
          <nav class="rd-navbar bg-yellow" data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fixed" data-sm-device-layout="rd-navbar-fixed" data-md-layout="rd-navbar-static" data-md-device-layout="rd-navbar-fixed" data-lg-device-layout="rd-navbar-static" data-lg-layout="rd-navbar-static" data-stick-up-clone="false" data-md-stick-up-offset="1px" data-lg-stick-up-offset="1px" data-md-stick-up="true" data-lg-stick-up="true">
            <div class="rd-navbar-main-outer">
              <div class="rd-navbar-main">
                <!-- RD Navbar Panel-->
                <div class="rd-navbar-panel">
                  <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar-nav-wrap"><span></span></button>
                  <!-- RD Navbar Brand-->
                  <div class="rd-navbar-brand"><a class="brand" href="/index.html">
                      <div class="brand__name"><img class="brand__logo-dark" src="/images//logo-default.png" alt=""/></div>
                      <span class="brand__slogan text-uppercase">Полуостров<br><small>имени<br>Леонида&nbsp;Духовного</small></span></a></div>
                </div>
                <!-- RD Navbar Nav-->
                <div class="rd-navbar-nav-wrap">
                  <div class="rd-navbar-element">
                    <ul class="list-icons list-inline-sm">
                      <li><a class="icon icon-sm fa fa-facebook icon-style-camera" href="https://www.facebook.com/groups/281683911878877"><span></span><span></span><span></span><span></span></a></li>
                    </ul>
                  </div>
                  <!-- RD Navbar Nav-->
                  <ul class="rd-navbar-nav">
                    <li><a href="/award/">Премия 2024<span></span><span></span><span></span><span></span></a>
                    </li>
                    <li><a href="/story.html">История Клуба<span></span><span></span><span></span><span></span></a>
                    </li>
                    <li><a href="/personalii.html">Персоналии<span></span><span></span><span></span><span></span></a>
                    </li>
                    <li class="active"><a href="/gallery.html">Фото и видео<span></span><span></span><span></span><span></span></a>
                    </li>
                    <li><a class="menu-button" href="https://www.poluostrovfestival.org/?PID=1037">Купить билеты<br><small>на мероприятия</small><span></span><span></span><span></span><span></span></a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>

      <!-- Breadcrumbs-->
      <section class="breadcrumbs-custom bg-gray-darker" style="margin-bottom:-40px; ">
        <div class="shell">
          <h1 class="breadcrumbs-custom__title">Фото и Видео</h1>
          <ul class="breadcrumbs-custom__path">
            <li class="gallery-title folder-load"><a href="#">Идет загрузка</a></li>
            <li class="gallery-title hide" id="title-blank"><a href="#"></a></li>
          </ul>
        </div>
      </section>


      <!-- Portfolio-->
      <section class="section section-md bg-gray-darker text-center loading" style="padding-top: 0; min-height: 330px;">
        <div class="shell-fluid">
          <div class="isotope thumb-ruby-wrap wow fadeIn" data-isotope-layout="masonry" data-isotope-group="gallery">
            <div class="data-wrap hide" id="wrap-blank">
            <div class="row row-folders bg-yellow-faded outline-yellow text-center hide">
              <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 isotope-item" id="blank-folder">
                <a class="thumb-ruby thumb-mixed_height-2 thumb-mixed_md folder-load" href="#">
                    <img class="thumb-ruby__image folder-icon" src="images/icon-white-folder.png" alt=""/>
                    <div class="thumb-ruby__caption"> 
                        <p class="thumb-ruby__text"></p>
                    </div>
                </a>
              </div>
            </div>
            <div class="row row-photos">
              <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 isotope-item" id="blank-photo">
                <a class="thumb-ruby thumb-mixed_height-2 thumb-mixed_md" href="" data-lightgallery="item">
                    <img class="thumb-ruby__image" src="" alt=""/>
                    <div class="thumb-ruby__caption"> 
                      <span class="lg-caption">
                        <p class="thumb-ruby__text"></p>
                        <p class="thumb-ruby__likes"></p>
                      </span>
                        <p class="video-icon hide"><img src="/images//icon-play.png"></p>
                        <div class="video-player" style="display:none;">
                          <iframe src="" width="640" height="480" allow="autoplay" class="lg-video-object lg-html5"></iframe>
                        </div>
                    </div>
                </a>
              </div>
            </div>
            </div>

          </div>
        </div>
      </section>

      <!-- Page Footer-->
      <footer class="footer-centered section bg-gray-darker" style="clear: both;">
        <div class="shell">
          <div class="range range-sm-center">
            <div class="cell-sm-10 cell-md-8 cell-lg-6 mt-5">
              <!-- Brand--><a class="brand" href="index.html">
                <div class="brand__name" style="overflow: unset; height: auto;"><img src="/images//logo-inverse.png" alt="" style="height:200px;"/>
                </div>
                <ul class="list-icons list-inline-sm">
                  <li><a class="icon icon-sm fa fa-facebook icon-style-camera" href="https://www.facebook.com/groups/281683911878877"><span></span><span></span><span></span><span></span></a></li>
                  <li><a class="icon icon-sm fa fa-festival icon-style-camera" href="https://poluostrovfestival.org">PoluostrovFestival.org<span></span><span></span><span></span><span></span></a></li>
                </ul>
              <!-- Rights-->
              <p class="rights"><span>КСП Полуостров</span><span>&nbsp;&copy;&nbsp; </span><span class="copyright-year"></span>.&nbsp; <br class="veil-xs"></span></p>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!-- Global Mailform Output-->
    <div class="snackbars" id="form-output-global"></div>
    <!-- Javascript-->
    <script src="js/core.min.js"></script>
    <script src="/js/script.js"></script>
    <script>

    function showMsg(msg,status) {
    	var output = $("#form-output-global");

    	if(status=="success") {
			var cls = "success", icon = "mdi mdi-check";
		}
		if (status=="error") {
			var cls = "error", icon = "mdi mdi-alert-outline";
		}
    if (status=="process") {
      var cls = "", icon = "fa fa-circle-o-notch fa-spin icon-xxs";
    }

			output.html('<p><span class="icon text-middle '+icon+' icon-xxs"></span><span>' + msg + '</span></p>');
			output.addClass("active "+cls);

		if (status!="process")
      setTimeout(function () {
			  output.removeClass("active");
		  }, 3500);

  }

      var likes_by_id = {};
      var likes_loaded = false;
      readLikes();
 
      function castLike(el,item_id) {
        if (el.classList.contains('voted')||(getCookie(item_id)!="")) { el.classList.add("voted"); showMsg("Вы уже проголосовали","error"); }
        else {
          el.classList.add("voted");
          el.innerText = parseInt(el.innerText)+1;
          $(".thumb-ruby__likes[data-id='"+item_id+"']").eq(0).addClass("voted");
          $(".thumb-ruby__likes[data-id='"+item_id+"']").eq(0).text(el.innerText);
          showMsg("Голос отправляется...","process");
          var formdata = { "id":item_id, 'ip_address' : user_ip, 'time' : fullDate(new Date()) };
          updateSheets(formdata,'like');
        }
      }
      
      function readLikes() {
        var xhr = $.ajax({
          url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRvVnlSSsLiQvtadidEnu_KD2jfrKUp540xbG2Y7VA6rFE0EyA9I4iWymCemUyuQcbtxb_RG9Gb25_R/pub?output=csv&range=A1:A100000",
          dataType: "text"
          }).success(
            function (data) { 	
              var sheet_data = data.split(/\r?\n|\r/);
              var keys = sheet_data[0].split(',');
              for(var i = 1; i<sheet_data.length; i++)
                {
                var tmp = sheet_data[i].split(',');
                if (tmp[0] in likes_by_id) likes_by_id[tmp[0]]++;
                else likes_by_id[tmp[0]] = 1;
                };

                likes_loaded = true;

               }
            ).error (
            function (xhr) { return false; }
            );
        }

    var current_iframe;
    function reload_current_iframe() {
      $("iframe[src='"+current_iframe+"']").attr("src",current_iframe);
      current_iframe = null;
    }
      
  const listener = window.addEventListener('blur', () => {
    current_iframe = document.activeElement.src;
    $(".lg-next").on("click", reload_current_iframe);
    $(".lg-prev").on("click", reload_current_iframe);
});



    function process_name(name) {
      var end = (name.lastIndexOf(".")==-1) ? name.length : name.lastIndexOf(".");
      name = name.substr(0,end);
      var replacements = [ { "from" : "папа", "to" : "Леонид Духовный" }, { "from" : "папы", "to" : "Леонида Духовного" }, { "from" : "папе", "to" : "Леониду Духовному" },
                           { "from" : "Папа", "to" : "Леонид Духовный" }, { "from" : "Папы", "to" : "Леонида Духовного" }, { "from" : "Папе", "to" : "Леониду Духовному" } ];
      for (var i=0; i<replacements.length; i++)
        name = name.replace(replacements[i]['from'], replacements[i]['to']);
      return name;

    }

    function displayGallery(obj,target_layer) {
      var data = obj.children;
      var folder;
      var item;
      var subfolders = [];
      var children_list = "";
      var like_button = "";
      //var like_button = $("#like-button").html();
    	for (var i=0; i<data.length; i++) 
        if (data[i]["mimeType"]!="application/vnd.google-apps.folder")
          {
            item = target_layer.find("#blank-photo").eq(0);
            if (data[i]["mimeType"]=="video/mp4") {
              item.find(".video-icon").removeClass('hide');
              item.find(".video-player").attr("id","video-"+data[i]['id']);
              //item.find(".thumb-ruby__title").text("Видео #");
              item.find("iframe").attr("src",'https://drive.google.com/file/d/'+data[i]['id']+'/preview');
              item.find(".thumb-ruby").attr("data-html","#video-"+data[i]['id']);
              item.find(".thumb-ruby").attr("href","");
            }
            else { 
              item.find(".thumb-ruby").removeAttr("data-html");
              item.find(".thumb-ruby").removeAttr("data-poster");
              item.find(".thumb-ruby").attr("href",'https://drive.google.com/thumbnail?authuser=0&sz=w1920&id='+data[i]['id']);
              //item.find(".thumb-ruby__title").text("Фото #");
              item.find(".video-icon").addClass('hide');
            }
              var voted = (getCookie(data[i]['id'])!="") ? " voted" : "";
              var num = (likes_by_id[data[i]['id']]) ? likes_by_id[data[i]['id']] : "0";
              like_button = '<button class="like-button'+voted+'" onLoad="alert(1);" onClick="castLike(this,'+"'"+data[i]['id']+"'"+')">'+num+'</button>';

              item.find(".thumb-ruby__likes").text(num);
              item.find(".thumb-ruby__likes").attr("data-id",data[i]['id']);

              if (voted!="") item.find(".thumb-ruby__likes").addClass(voted);
              else item.find(".thumb-ruby__likes").removeClass("voted");

              var cropped_name = process_name(data[i]['name']);
              item.find(".thumb-ruby__text").text(cropped_name);
              item.find(".thumb-ruby__image").attr("src",'https://drive.google.com/thumbnail?authuser=0&sz=w400&id='+data[i]['id']);
              
              item.find(".thumb-ruby").attr("data-sub-html",(cropped_name+like_button));
          target_layer.find(".row-photos").append('<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 isotope-item">'+item.html()+"</div>");
	        }
        else {
          folder = target_layer.find("#blank-folder").eq(0);
          children_list += data[i]['id'] + " ";
          subfolders.push(Object.create(obj));
          subfolders[subfolders.length-1].init(data[i]['id'],obj,newGallery);

          var cropped_name = process_name(data[i]['name']);
          folder.find(".thumb-ruby__text").text(cropped_name);
          folder.find("a").attr("data-id",data[i]['id']);
          target_layer.find(".row-folders").append('<div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 isotope-item mb-2">'+folder.html()+"</div>");
        }
	    if (item) item.remove();
      if (folder) folder.remove();
      if (subfolders.length) { 
        target_layer.find(".row-folders").removeClass('hide');
        $(".folder-load[data-id='"+obj.id+"']").each(function () { $(this).attr("data-children",children_list);}); 
      }

      $(".folder-load").each( function(index) { 
         $(this).on("click", function(e) {
            e.preventDefault();
            e.stopPropagation();
            var children_list = [];
            if ($(this).attr("data-children")) children_list = $(this).attr("data-children").split(" ");
            for (var i=0; i<children_list.length-1;i++)
              $(".gallery-title[data-id="+children_list[i]+"]").removeClass("current").addClass("hide");

            $(".data-wrap").addClass("hide");
            $("#wrap-"+$(this).attr("data-id")).removeClass("hide");
            $(".gallery-title[data-id='"+$(this).attr("data-id")+"']").addClass("current").removeClass("hide");

            current_folder = $(this).attr("data-id");

            $(".gallery-title[data-id!="+$(this).attr("data-id")+"]").removeClass("current").removeClass("active");
            if (!obj.parent) $(".gallery-title").eq(0).addClass("active");
          });});

        var itemsToInit = $( '[data-lightgallery="group-'+obj.id+'"]' );
        $( itemsToInit ).lightGallery( {
					thumbnail: $( itemsToInit ).attr( "data-lg-thumbnail" ) !== "false",
					selector: "[data-lightgallery='item']",
					autoplay: $( itemsToInit ).attr( "data-lg-autoplay" ) === "true",
					pause: parseInt( $( itemsToInit ).attr( "data-lg-autoplay-delay" ) ) || 5000,
					mode: $( itemsToInit ).attr( "data-lg-animation" ) || "lg-slide",
					loop: $( itemsToInit ).attr( "data-lg-loop" ) !== "false",
          videojs: true
				} );

	    target_layer.closest('.bg-gray-darker').removeClass('loading');
    }

    function newGallery(obj) {
      $("#wrap-blank").closest(".isotope").append('<div class="data-wrap hide" id="wrap-'+obj.id+'" data-lightgallery="group-'+obj.id+'">'+$("#wrap-blank").html()+"</div>");
      $("#title-blank").closest("ul").append('<li class="gallery-title hide" data-id="'+obj.id+'">'+$("#title-blank").html()+"</li>");
      $(".gallery-title").eq($(".gallery-title").length-1).find("a").text(obj.self.name);
      $(".gallery-title").eq($(".gallery-title").length-1).addClass("current");
      if ($(".gallery-title[data-id='"+obj.id+"']").length>1) $(".gallery-title").eq($(".gallery-title").length-1).addClass("folder-load");
      $(".gallery-title").eq($(".gallery-title").length-1).on("click",function(){
        if(current_folder!=$(this).attr("data-id")) {
            $(".folder-load[data-id='"+$(this).attr("data-id")+"']").eq(0).trigger("click");
          }
        });
      displayGallery(obj,$("#wrap-"+obj.id));
    }

    function maybeLoad() {
      if (drive_preload.self_loaded&&drive_preload.children_loaded&&likes_loaded) {
        $(".gallery-title").eq(0).attr("data-id",drive_preload.id);
        newGallery(drive_preload);
        $(".gallery-title").eq(0).addClass("active");
        $(".gallery-title").eq(0).find("a").text("Начало");
        $("#wrap-"+drive_preload.id).removeClass('hide');
        $(".gallery-title[data-id='"+drive_preload.id+"']").removeClass('hide');
      }
      else setTimeout( maybeLoad, 1000);
    }
    var current_folder = drive_preload.id;
    maybeLoad();

    </script>
    <!-- coded by Himic, edited and coded by Hanna -->
  </body>
</html>
